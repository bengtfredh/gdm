From 1eb1f09bcfa3f7c3c33da0ef24c5a528e53528cd Mon Sep 17 00:00:00 2001
From: Ray Strode <rstrode@redhat.com>
Date: Wed, 19 Jan 2011 13:32:28 -0500
Subject: [PATCH] user-chooser-widget: fix ref counting issue on user pixbuf

---
 gui/simple-greeter/gdm-user-chooser-widget.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/gui/simple-greeter/gdm-user-chooser-widget.c b/gui/simple-greeter/gdm-user-chooser-widget.c
index 6d03c38..9447e59 100644
--- a/gui/simple-greeter/gdm-user-chooser-widget.c
+++ b/gui/simple-greeter/gdm-user-chooser-widget.c
@@ -949,7 +949,14 @@ update_icons (GdmChooserWidget *widget,
               IconUpdateData   *data)
 {
         if (data->old_icon == *image) {
+                if (*image != NULL) {
+                        g_object_unref (*image);
+                }
                 *image = data->new_icon;
+
+                if (*image != NULL) {
+                        g_object_ref (*image);
+                }
                 return TRUE;
         }
 
-- 
1.7.3.4

